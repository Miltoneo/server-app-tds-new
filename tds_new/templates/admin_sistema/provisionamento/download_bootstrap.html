{% extends 'admin_sistema/base_admin.html' %}

{% block content %}
<div class="container-fluid">
    <div class="row justify-content-center">
        <div class="col-lg-8">

            <!-- Dados do Bootstrap Cert -->
            <div class="card mb-3">
                <div class="card-header">
                    <strong><i class="bi bi-shield-lock me-2"></i>Bootstrap Certificate — {{ bootstrap.label }}</strong>
                    {% if bootstrap.is_active %}<span class="badge bg-success ms-2">ATIVO</span>{% endif %}
                </div>
                <div class="card-body">
                    <table class="table table-sm mb-0">
                        <tr><th style="width:180px">Identificação</th><td>{{ bootstrap.label }}</td></tr>
                        <tr><th>Serial Number</th><td><code>{{ bootstrap.serial_number }}</code></td></tr>
                        <tr><th>Fingerprint SHA-256</th><td><code class="small">{{ bootstrap.fingerprint_sha256|default:"—" }}</code></td></tr>
                        <tr><th>Válido até</th><td>{{ bootstrap.expires_at|date:"d/m/Y H:i" }} ({{ bootstrap.dias_para_expiracao }} dias)</td></tr>
                        <tr><th>Gerado em</th><td>{{ bootstrap.created_at|date:"d/m/Y H:i" }} por {{ bootstrap.created_by.email|default:"sistema" }}</td></tr>
                    </table>
                </div>
            </div>

            <!-- Conteúdo do ZIP -->
            <div class="card mb-3">
                <div class="card-header"><strong><i class="bi bi-file-zip me-2"></i>Conteúdo do Pacote ZIP</strong></div>
                <div class="card-body">
                    <table class="table table-sm mb-0">
                        <thead class="table-light">
                            <tr><th>Arquivo</th><th>Descrição</th><th>Destino NVS</th></tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>bootstrap.crt</code></td>
                                <td>Certificado bootstrap (compartilhado)</td>
                                <td><code>bootstrap/cert</code></td>
                            </tr>
                            <tr>
                                <td><code>bootstrap.key</code></td>
                                <td>Chave privada bootstrap</td>
                                <td><code>bootstrap/key</code></td>
                            </tr>
                            <tr>
                                <td><code>ca.crt</code></td>
                                <td>Certificado raiz da CA</td>
                                <td><code>bootstrap/ca_crt</code></td>
                            </tr>
                            <tr>
                                <td><code>README_nvs.txt</code></td>
                                <td>Instruções de gravação NVS</td>
                                <td>—</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Alerta de segurança -->
            <div class="alert alert-warning d-flex gap-2 mb-3">
                <i class="bi bi-exclamation-triangle-fill fs-5"></i>
                <div>
                    <strong>Atenção:</strong> Este pacote contém a chave privada do bootstrap cert.
                    Guarde com segurança e restrinja o acesso à equipe de fábrica.
                    Grave em <strong>todos</strong> os devices do lote.
                </div>
            </div>

            <!-- Download -->
            <form method="post">
                {% csrf_token %}
                <div class="d-flex gap-2">
                    <button type="submit" class="btn btn-success">
                        <i class="bi bi-download me-2"></i>Baixar ZIP de Fábrica
                    </button>
                    <a href="{% url 'tds_new:admin_bootstrap_list' %}" class="btn btn-outline-secondary">
                        Voltar
                    </a>
                </div>
            </form>

        </div>
    </div>
</div>
{% endblock %}
